---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';
import { getCollection } from 'astro:content';
import FormattedDate from '../../components/FormattedDate.astro';

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const continents = [...new Set(posts.map((post) => post.data.continent))];
const countries = [...new Set(posts.map((post) => post.data.country))];
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body class="bg-white text-black">
    <Header />
    <main class="max-w-screen-md w-full mx-auto px-4 py-8">
      <div class="mb-8 flex flex-wrap gap-4" id="filters">
        <div>
          <label for="continent" class="block text-sm font-medium mb-1">Continente</label>
          <select id="continent" class="bg-gray-300 rounded-lg px-5 py-2">
            <option value="">Todos</option>
            {continents.map((continent) => (
              <option value={continent}>{continent}</option>
            ))}
          </select>
        </div>

        <div>
          <label for="country" class="block text-sm font-medium mb-1">Pa√≠s</label>
          <select id="country" class="bg-gray-300 rounded-lg px-5 py-2">
            <option value="">Todos</option>
            {countries.map((country) => (
              <option value={country}>{country}</option>
            ))}
          </select>
        </div>
      </div>
      <section>
        <ul class="flex flex-wrap gap-8 list-none m-0 p-0" id="post-list">
          {posts.map((post, index) => (
            <li
              class={`post-item ${
                index === 0 ? 'w-full mb-4 text-center' : 'w-[calc(50%-1rem)]'
              }`}
              data-continent={post.data.continent}
              data-country={post.data.country}
            >
              <a href={`/blog/${post.id}/`} class="block group">
                <img
                  width={720}
                  height={360}
                  src={post.data.heroImage}
                  alt=""
                  class={`mb-2 rounded-xl transition-shadow duration-200 ${
                    index === 0 ? 'w-full' : ''
                  } group-hover:shadow-lg`}
                />
                <h2
                  class={`text-black leading-none m-0 transition-colors duration-200 group-hover:text-accent ${
                    index === 0 ? 'text-4xl sm:text-2xl' : 'text-xl'
                  }`}
                >
                  {post.data.title}
                </h2>
                <p class="text-gray-500 m-0 transition-colors duration-200 group-hover:text-accent">
                  <FormattedDate date={post.data.pubDate} />
                </p>
              </a>
            </li>
          ))}
        </ul>
      </section>
    </main>

    <Footer />

    <!-- Script de filtrado -->
  	<script>
		document.addEventListener('DOMContentLoaded', () => {
			const continentSelect = document.getElementById('continent') as HTMLSelectElement;
			const countrySelect = document.getElementById('country') as HTMLSelectElement;
			const postItems = document.querySelectorAll<HTMLElement>('.post-item');

			function filterPosts() {
			const selectedContinent = continentSelect.value;
			const selectedCountry = countrySelect.value;

			postItems.forEach((item) => {
				const itemContinent = item.dataset.continent;
				const itemCountry = item.dataset.country;

				const matchesContinent = !selectedContinent || itemContinent === selectedContinent;
				const matchesCountry = !selectedCountry || itemCountry === selectedCountry;

				item.style.display = matchesContinent && matchesCountry ? '' : 'none';
			});
			}

			continentSelect.addEventListener('change', filterPosts);
			countrySelect.addEventListener('change', filterPosts);
		});
	</script>


  </body>
</html>
